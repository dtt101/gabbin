<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <style>
          body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Helvetica,sans-serif;
            line-height: 1.5;
            margin: 15px;
            color: #111;
            background-color: #fff;
          }
        </style>
        <link href="https://npmcdn.com/basscss@8.0.1/css/basscss.min.css" rel="stylesheet">
        <link href="https://npmcdn.com/basscss-btn@1.1.0/css/btn.css" rel="stylesheet">
        <link href="https://npmcdn.com/basscss-btn-primary@1.1.0/css/btn-primary.css" rel="stylesheet">
    </head>
    <body>
      <div class="max-width-4 mx-auto">
        <div class="clearfix">
          <div id="chat" class="col col-6">
            <h1 class="h1">Talk</h1>
            <div>
              <textarea placeholder="How can we help?" id="msg" class="h2 col-8 p2"></textarea>
            </div>
            <button type="button" id="btnSend" class="btn btn-primary not-rounded">Send</button>
          </div>
          <div class="col col-6">
            <h1 class="h1">Responses</h1>
            <div id="responses"></div>
          </div>
        </div>
      </div>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
      <script type="text/javascript">
        var chatSocket = new WebSocket("ws://localhost:1337/converse");

        chatSocket.onmessage = function(event) {
          var msg = JSON.parse(event.data).msg;
          if (msg) {
            $('#responses').prepend("<p>" + msg + "</p>");
          }
        }

        chatSocket.onclose = function(event) {
          console.log('close ws called');
        }

        chatSocket.onopen = function(event) {
          console.log('open ws called');
        }

        chatSocket.onerror = function(event) {
          console.log('error ws called');
        }

        function createMessageJSON(text) {
          var msg = {
            type: "message",
            text: text,
            id:   "1",
            date: Date.now()
          };
          return JSON.stringify(msg);
        }

        $("#btnSend").click(function() {
          chatSocket.send(createMessageJSON($('#msg').val()));
          $('#msg').val('');
        });
      </script>
    </body>
</html>
